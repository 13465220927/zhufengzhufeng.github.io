<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Express | Tanlent Corder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Express 是一个简洁、灵活的 node.js Web 应用开发框架, 它提供一系列强大的特性，帮助你创建各种 Web 和移动设备应用。丰富的 HTTP 快捷方法和任意排列组合的 Connect 中间件，让你创建健壮、友好的 API 变得既快速又简单。此文章会讲解express常用方法以及实现的原理.">
<meta property="og:type" content="article">
<meta property="og:title" content="Express">
<meta property="og:url" content="https://zhufengzhufeng.github.io/2014/08/22/node/express/index.html">
<meta property="og:site_name" content="Tanlent Corder">
<meta property="og:description" content="Express 是一个简洁、灵活的 node.js Web 应用开发框架, 它提供一系列强大的特性，帮助你创建各种 Web 和移动设备应用。丰富的 HTTP 快捷方法和任意排列组合的 Connect 中间件，让你创建健壮、友好的 API 变得既快速又简单。此文章会讲解express常用方法以及实现的原理.">
<meta property="og:image" content="https://zhufengzhufeng.github.io/img/node.png">
<meta property="og:updated_time" content="2016-08-22T04:01:15.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Express">
<meta name="twitter:description" content="Express 是一个简洁、灵活的 node.js Web 应用开发框架, 它提供一系列强大的特性，帮助你创建各种 Web 和移动设备应用。丰富的 HTTP 快捷方法和任意排列组合的 Connect 中间件，让你创建健壮、友好的 API 变得既快速又简单。此文章会讲解express常用方法以及实现的原理.">
<meta name="twitter:image" content="https://zhufengzhufeng.github.io/img/node.png">
  
    <link rel="alternate" href="/atom.xml" title="Tanlent Corder" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">


    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Tanlent Corder</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <div class="mylogo"></div>
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">文章收藏</a>
        
      </nav>
      <!--<nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>-->
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://zhufengzhufeng.github.io"></form>
      </div>
    </div>
  </div>
</header>
<article class="outer searchbox" >
  <form id="search-form"> <!-- 搜索框相关 -->
    <label for="local-search-input" class="label-en">搜索文章</label>
    <input type="text" id="local-search-input" name="q" results="0" placeholder="搜索文章" class="search form-control" autocomplete="off" autocorrect="off"/>
    <i class="fa fa-times" onclick="resetSearch()">重置</i> <!-- 清空/重置搜索框 -->

  </form>
  <div style="clear: both"></div>
  <div id="local-search-result"></div> <!-- 搜索结果区 -->
  <p class='no-result'>No results found </p> <!-- 无匹配时显示，注意请在 CSS 中设置默认隐藏 -->
</article>



<style>
  /*搜索框*/
  .searchbox{
    padding-top: 20px;
  }
  .label-en{
    float: left;
    width: 100%;
    font-size: 18px;
    line-height: 30px;

  }
  .search {
    width: 60%;
    height: 30px;
    margin-bottom: 10px;
    font-family: inherit;
    border: 1px solid #ddd;
    box-shadow: 1px 2px 3px #ddd;
    border-radius: 2px;
    opacity: 0.65;
    background: #fff;
    padding:0 2%;
    float: left;
  }
  #search-form,#local-search-result,.no-result{
    width: 73.33333333333333%;
    margin: 0 0.833333333333333%;
  }


  /*搜索重置按钮*/
  #search-form .fa-times {
    display: none;
    float: left;
    height: 30px;
    line-height: 30px;
    border: 1px solid #ddd;
    box-shadow: 1px 2px 3px #ddd;
    cursor: pointer;
    color: #999;
    background:#fff;
    margin: 0 10px;
    width: 10%;
    text-align: center;
  }
  #search-form .fa-times:active {
    background: #d3d3d3;
  }

  /*搜索结果区*/
  #local-search-result {
    font-size: 0.9em;
    text-align: left;
    word-break: break-all;
  }

  #local-search-result ul.search-result-list li:hover {
    font-weight: normal;
  }

  /*单条搜索结果*/
  #local-search-result li {
    margin: 0.5em auto;
    border-bottom: 2px solid #d3d3d3;
  }
  #local-search-result .search-result-list li:hover {
    background: rgba(158,188,226,0.21);
    box-shadow: 0 0 5px rgba(0,0,0,0.2);
  }

  /*匹配的标题*/
  #local-search-result a.search-result-title {
    line-height: 1.2;
    font-weight: bold;
    color: #708090;
  }

  /*搜索预览段落*/
  #local-search-result p.search-result {
    margin: 0.4em auto;
    line-height: 1.2em;
    max-height: 3.6em;
    overflow: hidden;
    font-size: 0.8em;
    text-align: justify;
    color: #808080;
  }

  /*匹配的关键词*/
  #local-search-result em.search-keyword {
    color: #f58e90;
    border-bottom: 1px dashed #f58e90;
    font-weight: bold;
    font-size: 0.85em;
  }

  /*无匹配搜索结果时显示*/
  p.no-result {
    display: none;
    padding-bottom: 0.5em;
    text-align: left;
    color: #808080;
    font-family: font-serif serif;
    border-bottom: 2px solid #d3d3d3;
  }
</style>
      <div class="outer">
        <section id="main">





<article id="post-node/express" class="article article-type-post" itemscope itemprop="blogPost">








  
  <div class="article-meta">
    <a href="/2014/08/22/node/express/" class="article-date">
  <time datetime="2014-08-21T22:00:00.000Z" itemprop="datePublished">2014-08-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/NODE/">NODE</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Express
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Express 是一个简洁、灵活的 node.js Web 应用开发框架, 它提供一系列强大的特性，帮助你创建各种 Web 和移动设备应用。丰富的 HTTP 快捷方法和任意排列组合的 Connect 中间件，让你创建健壮、友好的 API 变得既快速又简单。此文章会讲解express常用方法以及实现的原理.<br><img src="/img/node.png" alt=""><br><a id="more"></a></p>
<h2 id="1-Express介绍"><a href="#1-Express介绍" class="headerlink" title="1.Express介绍"></a>1.Express介绍</h2><p>Express 是一个小巧且灵活的 Node.js Web应用框架，它有一套健壮的特性，可用于开发单页、多页和混合Web应用。</p>
<h2 id="2-express的应用"><a href="#2-express的应用" class="headerlink" title="2.express的应用"></a>2.express的应用</h2><h3 id="2-1-安装express"><a href="#2-1-安装express" class="headerlink" title="2.1 安装express"></a>2.1 安装express</h3><ul>
<li>npm安装<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install express</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="2-2-使用express"><a href="#2-2-使用express" class="headerlink" title="2.2 使用express"></a>2.2 使用express</h3><ul>
<li>创建http服务<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//引入express</span></div><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</div><div class="line"><span class="comment">//执行express**函数</span></div><div class="line"><span class="keyword">var</span> app = express();</div><div class="line"><span class="comment">//监听端口</span></div><div class="line">app.listen(<span class="number">3000</span>);</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="2-3-express的get方法"><a href="#2-3-express的get方法" class="headerlink" title="2.3 express的get方法"></a>2.3 express的get方法</h3><p>根据请求路径来处理客户端发出的GET请求</p>
<ul>
<li>第一个参数path为请求的路径</li>
<li>第二个参数为处理请求的回调函数<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line">app.get(path,<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>));</span></div><div class="line">```  </div><div class="line"></div><div class="line">#### 2.3.1 <span class="title">get</span>方法的使用  </div><div class="line">```<span class="title">javascript</span></div><div class="line">//引入<span class="title">express</span></div><div class="line"><span class="title">var</span> <span class="title">express</span> = <span class="title">require</span>(<span class="params">'./express'</span>);</div><div class="line">//执行<span class="title">express</span>函数</div><div class="line"><span class="title">var</span> <span class="title">app</span> = <span class="title">express</span>(<span class="params"></span>);</div><div class="line">//监听端口</div><div class="line"><span class="title">app</span>.<span class="title">get</span>(<span class="params">'/hello', function (req,res</span>) &#123;</div><div class="line">   res.end(<span class="string">'hello'</span>);</div><div class="line">&#125;);</div><div class="line">app.get(<span class="string">'/world'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</div><div class="line">    res.end(<span class="string">'world'</span>);</div><div class="line">&#125;);</div><div class="line">app.get(<span class="string">'*'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</div><div class="line">    res.setHeader(<span class="string">'content-type'</span>,<span class="string">'text/plain;charset=utf8'</span>);</div><div class="line">    res.end(<span class="string">'没有找到匹配的路径'</span>);</div><div class="line">&#125;);</div><div class="line">app.listen(<span class="number">3000</span>);</div><div class="line"><span class="string">``</span><span class="string">`  </span></div><div class="line"></div><div class="line">#### 2.3.2 get方法实现</div><div class="line">`<span class="string">``</span>javascript</div><div class="line"><span class="comment">//声明express函数</span></div><div class="line"><span class="keyword">var</span> express = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> app = <span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> urlObj  = <span class="built_in">require</span>(<span class="string">'url'</span>).parse(req.url,<span class="literal">true</span>);</div><div class="line">        <span class="keyword">var</span> pathname = urlObj.pathname;</div><div class="line">        <span class="keyword">var</span> method = req.method.toLowerCase();</div><div class="line">        <span class="comment">//找到匹配的路由</span></div><div class="line">        <span class="keyword">var</span> route = app.routes.find(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> item.path==pathname&amp;&amp;item.method==method;</div><div class="line">        &#125;);</div><div class="line">        <span class="keyword">if</span>(route)&#123;</div><div class="line">            route.fn(req,res);</div><div class="line">        &#125;</div><div class="line">        res.end(<span class="string">`CANNOT  <span class="subst">$&#123;method&#125;</span> <span class="subst">$&#123;pathname&#125;</span>`</span>)</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">//增加监听方法</span></div><div class="line">    app.listen = <span class="function"><span class="keyword">function</span> (<span class="params">port</span>) </span>&#123;</div><div class="line">        <span class="built_in">require</span>(<span class="string">'http'</span>).createServer(app).listen(port);</div><div class="line">    &#125;;</div><div class="line">    app.routes = [];</div><div class="line">    <span class="comment">//增加get方法</span></div><div class="line">    app.get = <span class="function"><span class="keyword">function</span> (<span class="params">path,fn</span>) </span>&#123;</div><div class="line">        app.routes.push(&#123;method:<span class="string">'get'</span>,path:path,fn:fn&#125;);</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">return</span> app;</div><div class="line">&#125;;</div><div class="line"><span class="built_in">module</span>.exports = express;</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-3-3-增加-匹配"><a href="#2-3-3-增加-匹配" class="headerlink" title="2.3.3 增加 * 匹配"></a>2.3.3 增加 * 匹配</h4><ul>
<li>使用 * 匹配所有路径<figure class="highlight diff"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">var route = app.routes.find(function (item) &#123;</div><div class="line"><span class="deletion">-      return item.path==pathname&amp;&amp;item.method==method;</span></div><div class="line"><span class="addition">+      return (item.path==pathname||item.path=='*')&amp;&amp;item.method==method;</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="2-4-express的post方法"><a href="#2-4-express的post方法" class="headerlink" title="2.4 express的post方法"></a>2.4 express的post方法</h3><p>根据请求路径来处理客户端发出的POST请求</p>
<ul>
<li>第一个参数path为请求的路径</li>
<li><p>第二个参数为处理请求的回调函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">app.post(path,<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>));</span></div><div class="line">```  </div><div class="line"></div><div class="line">#### 2.4.1 <span class="title">post</span>的方法使用  </div><div class="line">```<span class="title">javascript</span></div><div class="line">//引入<span class="title">express</span></div><div class="line"><span class="title">var</span> <span class="title">express</span> = <span class="title">require</span>(<span class="params">'./express'</span>);</div><div class="line">//执行<span class="title">express</span>函数</div><div class="line"><span class="title">var</span> <span class="title">app</span> = <span class="title">express</span>(<span class="params"></span>);</div><div class="line">//监听端口</div><div class="line"><span class="title">app</span>.<span class="title">post</span>(<span class="params">'/hello', function (req,res</span>) &#123;</div><div class="line">   res.end(<span class="string">'hello'</span>);</div><div class="line">&#125;);</div><div class="line">app.post(<span class="string">'*'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</div><div class="line">    res.end(<span class="string">'post没找到'</span>);</div><div class="line">&#125;);</div><div class="line">app.listen(<span class="number">3000</span>);</div></pre></td></tr></table></figure>
</li>
<li><p>通过linux命令发送post请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ curl -X POST http://localhost:3000/hello</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-4-2-post的实现"><a href="#2-4-2-post的实现" class="headerlink" title="2.4.2 post的实现"></a>2.4.2 post的实现</h4><ul>
<li>增加所有请求的方法<figure class="highlight diff"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">var methods = ['get','post','delete','put','options'];</div><div class="line">methods.forEach(function (method) &#123;</div><div class="line">    app[method] = function (path,fn) &#123;</div><div class="line">        app.routes.push(&#123;method:method,path:path,fn:fn&#125;);</div><div class="line">    &#125;;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="2-5-express的all方法"><a href="#2-5-express的all方法" class="headerlink" title="2.5 express的all方法"></a>2.5 express的all方法</h3><p>监听所有的请求方法，可以匹配所有的HTTP动词<br>根据请求路径来处理客户端发出的所有请求</p>
<ul>
<li>第一个参数path为请求的路径</li>
<li>第二个参数为处理请求的回调函数  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">app.all(path,<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>));</span></div><div class="line">```  </div><div class="line"></div><div class="line">#### 2.5.1 <span class="title">all</span>的方法使用</div><div class="line">```<span class="title">javascript</span></div><div class="line"><span class="title">var</span> <span class="title">express</span> = <span class="title">require</span>(<span class="params">'./express'</span>);</div><div class="line"><span class="title">var</span> <span class="title">app</span> = <span class="title">express</span>(<span class="params"></span>);</div><div class="line"><span class="title">app</span>.<span class="title">all</span>(<span class="params">'/hello', function (req,res</span>) &#123;</div><div class="line">   res.end(<span class="string">'hello'</span>);</div><div class="line">&#125;);</div><div class="line">app.all(<span class="string">'*'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</div><div class="line">    res.end(<span class="string">'没找到'</span>);</div><div class="line">&#125;);</div><div class="line">app.listen(<span class="number">3000</span>);</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-5-2-注册所有方法"><a href="#2-5-2-注册所有方法" class="headerlink" title="2.5.2 注册所有方法"></a>2.5.2 注册所有方法</h4><ul>
<li>增加all方法匹配所有method <figure class="highlight diff"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="addition">+  var methods = ['get','post','delete','put','options','all'];</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-5-3-all方法的实现"><a href="#2-5-3-all方法的实现" class="headerlink" title="2.5.3 all方法的实现"></a>2.5.3 all方法的实现</h4><ul>
<li>对all方法进行判断<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> route = app.routes.find(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</div><div class="line">-      <span class="keyword">return</span> (item.path==pathname||item.path==<span class="string">'*'</span>)&amp;&amp;item.method==method;</div><div class="line">+      <span class="keyword">return</span> (item.path==pathname||item.path==<span class="string">'*'</span>)&amp;&amp;(item.method==method||method==<span class="string">'all'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="2-6-中间件"><a href="#2-6-中间件" class="headerlink" title="2.6 中间件"></a>2.6 中间件</h3><p>中间件就是处理HTTP请求的函数，用来完成各种特定的任务，比如检查用户是否登录、检测用户是否有权限访问等，它的特点是:</p>
<ul>
<li>一个中间件处理完请求和响应可以把相应数据再传递给下一个中间件</li>
<li>回调函数的next参数,表示接受其他中间件的调用，函数体中的next(),表示将请求数据继续传递</li>
<li>可以根据路径来区分返回执行不同的中间件  </li>
</ul>
<h4 id="2-6-1-中间件的使用方法"><a href="#2-6-1-中间件的使用方法" class="headerlink" title="2.6.1 中间件的使用方法"></a>2.6.1 中间件的使用方法</h4><ul>
<li>增加中间件<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</div><div class="line"><span class="keyword">var</span> app = express();</div><div class="line">app.use(<span class="function"><span class="keyword">function</span> (<span class="params">req,res,next</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'过滤石头'</span>);</div><div class="line">    next();</div><div class="line">&#125;);</div><div class="line">app.use(<span class="string">'/water'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req,res,next</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'过滤沙子'</span>);</div><div class="line">    next();</div><div class="line">&#125;);</div><div class="line">app.get(<span class="string">'/water'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</div><div class="line">    res.end(<span class="string">'water'</span>);</div><div class="line">&#125;);</div><div class="line">app.listen(<span class="number">3000</span>);</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-6-2-use方法的实现"><a href="#2-6-2-use方法的实现" class="headerlink" title="2.6.2 use方法的实现"></a>2.6.2 use方法的实现</h4><ul>
<li><p>在路由数组中增加中间件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">app.use = <span class="function"><span class="keyword">function</span> (<span class="params">path,fn</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> fn !=<span class="string">'function'</span>)&#123;</div><div class="line">        fn = path;</div><div class="line">        path = <span class="string">'/'</span>;</div><div class="line">    &#125;</div><div class="line">    app.routes.push(&#123;method:<span class="string">'middle'</span>,path:path,fn:fn&#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>app方法中增加Middleware判断</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">- <span class="keyword">var</span> route = app.routes.find(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</div><div class="line">-    <span class="keyword">return</span> item.path==pathname&amp;&amp;item.method==method;</div><div class="line">- &#125;);</div><div class="line">- <span class="keyword">if</span>(route)&#123;</div><div class="line">-     route.fn(req,res);</div><div class="line">- &#125;</div><div class="line"><span class="keyword">var</span> index = <span class="number">0</span>;</div><div class="line"><span class="function"><span class="keyword">function</span>  <span class="title">next</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">if</span>(index&gt;=app.routes.length)&#123;</div><div class="line">         <span class="keyword">return</span> res.end(<span class="string">`CANNOT  <span class="subst">$&#123;method&#125;</span> <span class="subst">$&#123;pathname&#125;</span>`</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> route = app.routes[index++];</div><div class="line">    <span class="keyword">if</span>(route.method == <span class="string">'middle'</span>)&#123;</div><div class="line">        <span class="keyword">if</span>(route.path == <span class="string">'/'</span>||pathname.startsWith(route.path+<span class="string">'/'</span>)|| pathname==route.path)&#123;</div><div class="line">            route.fn(req,res,next)</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            next();</div><div class="line">        &#125;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="keyword">if</span>((route.path==pathname||route.path==<span class="string">'*'</span>)&amp;&amp;(route.method==method||route.method==<span class="string">'all'</span>))&#123;</div><div class="line">            route.fn(req,res);</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            next();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">next();</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-6-3-错误中间件"><a href="#2-6-3-错误中间件" class="headerlink" title="2.6.3 错误中间件"></a>2.6.3 错误中间件</h4><ul>
<li>next中可以传递错误，默认执行错误中间件<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</div><div class="line"><span class="keyword">var</span> app = express();</div><div class="line">app.use(<span class="function"><span class="keyword">function</span> (<span class="params">req,res,next</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'过滤石头'</span>);</div><div class="line">    next(<span class="string">'stone is too big'</span>);</div><div class="line">&#125;);</div><div class="line">app.use(<span class="string">'/water'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req,res,next</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'过滤沙子'</span>);</div><div class="line">    next();</div><div class="line">&#125;);</div><div class="line">app.get(<span class="string">'/water'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</div><div class="line">    res.end(<span class="string">'water'</span>);</div><div class="line">&#125;);</div><div class="line">app.use(<span class="function"><span class="keyword">function</span> (<span class="params">err,req,res,next</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(err);</div><div class="line">    res.end(err);</div><div class="line">&#125;);</div><div class="line">app.listen(<span class="number">3000</span>);</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-6-4-错误中间件的实现"><a href="#2-6-4-错误中间件的实现" class="headerlink" title="2.6.4 错误中间件的实现"></a>2.6.4 错误中间件的实现</h4><ul>
<li>对错误中间件进行处理<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span>  <span class="title">next</span>(<span class="params">err</span>)</span>&#123;</div><div class="line">    <span class="keyword">if</span>(index&gt;=app.routes.length)&#123;</div><div class="line">        <span class="keyword">return</span> res.end(<span class="string">`CANNOT  <span class="subst">$&#123;method&#125;</span> <span class="subst">$&#123;pathname&#125;</span>`</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> route = app.routes[index++];</div><div class="line">+    <span class="keyword">if</span>(err)&#123;</div><div class="line">+        <span class="keyword">if</span>(route.method == <span class="string">'middle'</span>&amp;&amp;route.fn.length==<span class="number">4</span>)&#123;</div><div class="line">+            route.fn(err,req,res,next);</div><div class="line">+        &#125;<span class="keyword">else</span>&#123;</div><div class="line">+            next(err);</div><div class="line">+        &#125;</div><div class="line">+    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="keyword">if</span>(route.method == <span class="string">'middle'</span>)&#123;</div><div class="line">            <span class="keyword">if</span>(route.path == <span class="string">'/'</span>||pathname.startsWith(route.path+<span class="string">'/'</span>)|| pathname==route.path)&#123;</div><div class="line">                route.fn(req,res,next)</div><div class="line">            &#125;<span class="keyword">else</span>&#123;</div><div class="line">                next();</div><div class="line">            &#125;</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            <span class="keyword">if</span>((route.path==pathname||route.path==<span class="string">'*'</span>)&amp;&amp;(route.method==method||route.method==<span class="string">'all'</span>))&#123;</div><div class="line">                route.fn(req,res);</div><div class="line">            &#125;<span class="keyword">else</span>&#123;</div><div class="line">                next();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">+    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="2-7-获取参数和查询字符串"><a href="#2-7-获取参数和查询字符串" class="headerlink" title="2.7 获取参数和查询字符串"></a>2.7 获取参数和查询字符串</h3><ul>
<li>req.hostname 返回请求头里取的主机名</li>
<li>req.path 返回请求的URL的路径名</li>
<li>req.query 查询字符串<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//http://localhost:3000/?a=1</span></div><div class="line">app.get(<span class="string">'/'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</div><div class="line">    res.write(<span class="built_in">JSON</span>.stringify(req.query))</div><div class="line">    res.end(req.hostname+<span class="string">" "</span>+req.path);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-7-1-具体实现"><a href="#2-7-1-具体实现" class="headerlink" title="2.7.1 具体实现"></a>2.7.1 具体实现</h4><ul>
<li>对请求增加方法<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">+     req.path = pathname;</div><div class="line">+     req.hostname = req.headers[<span class="string">'host'</span>].split(<span class="string">':'</span>)[<span class="number">0</span>];</div><div class="line">+     req.query = urlObj.query;</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="2-8-获取params参数"><a href="#2-8-获取params参数" class="headerlink" title="2.8 获取params参数"></a>2.8 获取params参数</h3><ul>
<li>req.params 匹配到的所有路径参数组成的对象<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">app.get(<span class="string">'/water/:id/:name/home/:age'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(req.params);</div><div class="line">    res.end(<span class="string">'water'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-8-1-params实现"><a href="#2-8-1-params实现" class="headerlink" title="2.8.1 params实现"></a>2.8.1 params实现</h4><ul>
<li><p>增加params属性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line">methods.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">method</span>) </span>&#123;</div><div class="line">    app[method] = <span class="function"><span class="keyword">function</span> (<span class="params">path,fn</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> config = &#123;method:method,path:path,fn:fn&#125;;</div><div class="line">        <span class="keyword">if</span>(path.includes(<span class="string">":"</span>))&#123;</div><div class="line">            <span class="comment">//是路径参数 转换为正则</span></div><div class="line">            <span class="comment">//并且增加params</span></div><div class="line">            <span class="keyword">var</span> arr = [];</div><div class="line">            config.path   = path.replace(<span class="regexp">/:([^\/]+)/g</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                arr.push(<span class="built_in">arguments</span>[<span class="number">1</span>]);</div><div class="line">                <span class="keyword">return</span> <span class="string">'([^\/]+)'</span>;</div><div class="line">            &#125;);</div><div class="line">            config.params = arr;</div><div class="line">        &#125;</div><div class="line">        app.routes.push(config);</div><div class="line">    &#125;;</div><div class="line">&#125;);</div><div class="line">+ <span class="keyword">if</span>(route.params)&#123;</div><div class="line">+    <span class="keyword">var</span> matchers = pathname.match(<span class="keyword">new</span> <span class="built_in">RegExp</span>(route.path));</div><div class="line">+    <span class="keyword">if</span>(matchers)&#123;</div><div class="line">+       <span class="keyword">var</span> params = &#123;&#125;;</div><div class="line">+        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i&lt;route.params.length;i++)&#123;</div><div class="line">+            params[route.params[i]] = matchers[i+<span class="number">1</span>];</div><div class="line">+        &#125;</div><div class="line">+        req.params = params;</div><div class="line">+        route.fn(req,res);</div><div class="line">+    &#125;<span class="keyword">else</span>&#123;</div><div class="line">+        next();</div><div class="line">+    &#125;</div><div class="line">+&#125;<span class="keyword">else</span>&#123;</div><div class="line">    <span class="keyword">if</span>((route.path==pathname||route.path==<span class="string">'*'</span>)&amp;&amp;(route.method==method||route.method==<span class="string">'all'</span>))&#123;</div><div class="line">        route.fn(req,res);</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        next();</div><div class="line">    &#125;</div><div class="line">+&#125;</div><div class="line"> <span class="comment">//如果不等于就是路由</span></div><div class="line"><span class="keyword">if</span>(item.params)&#123;</div><div class="line">    <span class="comment">//带params</span></div><div class="line">    <span class="keyword">var</span> arr = pathname.match(<span class="keyword">new</span> <span class="built_in">RegExp</span>(item.path));</div><div class="line">    <span class="keyword">if</span>(arr)&#123;</div><div class="line">        <span class="keyword">var</span> obj = &#123;&#125;;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">1</span>; i&lt;=item.params.length;i++)&#123;</div><div class="line">            obj[item.params[i<span class="number">-1</span>]] = arr[i];</div><div class="line">        &#125;</div><div class="line">        req.params = obj;</div><div class="line">        item.fn(req,res);</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        next();</div><div class="line">    &#125;</div><div class="line">&#125;<span class="keyword">else</span>&#123;</div><div class="line">    <span class="keyword">if</span>(item.path==pathname||item.path==<span class="string">'*'</span>&amp;&amp;item.method ==method)&#123;</div><div class="line">        item.fn(req,res);</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        next();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="string">``</span><span class="string">` </span></div><div class="line">### 2.9 express中的send方法</div><div class="line"></div><div class="line">- 参数为要响应的内容,可以智能处理不同类型的数据,在输出响应时会自动进行一些设置，比如HEAD信息、HTTP缓存支持等等</div><div class="line"></div><div class="line">`<span class="string">``</span>javascript</div><div class="line">res.send([body]);</div></pre></td></tr></table></figure>
</li>
<li><p>当参数是一个字符串时，这个方法会设置Content-type为<code>text/html</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</div><div class="line">    res.send(<span class="string">'&lt;p&gt;hello world&lt;/p&gt;'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
<li><p>当参数是一个Array或者Object，这个方法返回json格式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">app.get(<span class="string">'/json'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</div><div class="line">     res.send(&#123;obj:<span class="number">1</span>&#125;);</div><div class="line">&#125;);</div><div class="line">app.get(<span class="string">'/arr'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</div><div class="line"> res.send([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
<li><p>当参数是一个number类型，这个方法返回对应的状态码短语</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">app.get(&apos;/status&apos;, function (req,res) &#123;</div><div class="line">    res.send(404); //not found</div><div class="line">    //res.status(404).send(&apos;没有找到&apos;);设置短语</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-9-1-send方法的实现"><a href="#2-9-1-send方法的实现" class="headerlink" title="2.9.1 send方法的实现"></a>2.9.1 send方法的实现</h4><ul>
<li>自定义send方法 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">res.send = <span class="function"><span class="keyword">function</span> (<span class="params">msg</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> msg==<span class="string">'string'</span>||Buffer.isBuffer(msg))&#123;</div><div class="line">        res.contentType(<span class="string">'text/html'</span>);</div><div class="line">        res.end(msg);</div><div class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">typeof</span> msg==<span class="string">'object'</span>)&#123;</div><div class="line">        res.contentType(<span class="string">'application/json'</span>);</div><div class="line">        res.end(<span class="built_in">JSON</span>.stringify(msg));</div><div class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">typeof</span> msg == <span class="string">'number'</span>)&#123;</div><div class="line">        res.contentType(<span class="string">'text/plain'</span>);</div><div class="line">        <span class="keyword">var</span> status_code = <span class="built_in">require</span>(<span class="string">'_http_server'</span>).STATUS_CODES</div><div class="line">        res.end(status_code[msg]);</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="3-模板的应用"><a href="#3-模板的应用" class="headerlink" title="3. 模板的应用"></a>3. 模板的应用</h2><h3 id="3-1-安装ejs"><a href="#3-1-安装ejs" class="headerlink" title="3.1 安装ejs"></a>3.1 安装ejs</h3><ul>
<li>npm安装ejs<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install ejs</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="3-2-设置模板"><a href="#3-2-设置模板" class="headerlink" title="3.2 设置模板"></a>3.2 设置模板</h3><ul>
<li>使用ejs模版<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</div><div class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</div><div class="line"><span class="keyword">var</span> app = express();</div><div class="line">app.set(<span class="string">'view engine'</span>,<span class="string">'ejs'</span>);</div><div class="line">app.set(<span class="string">'views'</span>,path.join(__dirname,<span class="string">'views'</span>));</div><div class="line">app.listen(<span class="number">3000</span>);</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="3-3-渲染html"><a href="#3-3-渲染html" class="headerlink" title="3.3 渲染html"></a>3.3 渲染html</h3><ul>
<li>配置成html格式<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">app.set(<span class="string">'view engine'</span>,<span class="string">'html'</span>)</div><div class="line">app.set(<span class="string">'views'</span>,path.join(__dirname,<span class="string">'views'</span>)); </div><div class="line">app.engine(<span class="string">'html'</span>,<span class="built_in">require</span>(<span class="string">'ejs'</span>).__express);</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="3-4-渲染视图"><a href="#3-4-渲染视图" class="headerlink" title="3.4 渲染视图"></a>3.4 渲染视图</h3><ul>
<li>第一个参数 要渲染的模板</li>
<li>第二个参数 渲染所需要的数据<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</div><div class="line">    res.render(<span class="string">'hello'</span>,&#123;title:<span class="string">'hello'</span>&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;&#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="3-5-模板的实现"><a href="#3-5-模板的实现" class="headerlink" title="3.5 模板的实现"></a>3.5 模板的实现</h3><ul>
<li>读取模版渲染<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">res.render = <span class="function"><span class="keyword">function</span> (<span class="params">tmpl,obj,fn</span>) </span>&#123;</div><div class="line">        tmpl = tmpl+(tmpl.endsWith(<span class="string">'.ejs'</span>)?<span class="string">''</span>:<span class="string">'.ejs'</span>);</div><div class="line">        <span class="keyword">var</span> filepath = path.join(app.get(<span class="string">'views'</span>),tmpl);</div><div class="line">        fs.readFile(filepath,<span class="string">'utf8'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</div><div class="line">            data = data.replace(<span class="regexp">/&lt;%=(\w+)%&gt;/g</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                <span class="keyword">return</span> obj[<span class="built_in">arguments</span>[<span class="number">1</span>]];</div><div class="line">            &#125;);</div><div class="line">            <span class="keyword">if</span>(<span class="keyword">typeof</span> fn ==<span class="string">'function'</span>)&#123;</div><div class="line">                fn(err,data);</div><div class="line">            &#125;<span class="keyword">else</span>&#123;</div><div class="line">                res.end(data);</div><div class="line">            &#125;</div><div class="line">        &#125;)</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="4-静态文件服务器"><a href="#4-静态文件服务器" class="headerlink" title="4.静态文件服务器"></a>4.静态文件服务器</h2><ul>
<li>如果要在网页中加载静态文件（css、js、img），就需要另外指定一个存放静态文件的目录，当浏览器发出非HTML文件请求时，服务器端就会到这个目录下去寻找相关文件<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">var express = require(&apos;express&apos;);</div><div class="line">var app = express();</div><div class="line">var path = require(&apos;path&apos;);</div><div class="line">app.use(express.static(path.join(__dirname,&apos;public&apos;)));</div><div class="line">app.listen(3000);</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="4-1-静态文件服务器实现"><a href="#4-1-静态文件服务器实现" class="headerlink" title="4.1 静态文件服务器实现"></a>4.1 静态文件服务器实现</h3><ul>
<li>配置静态服务器<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">static</span>(<span class="params">p</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">req,res,next</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> exists = fs.existsSync(p);</div><div class="line">        <span class="keyword">if</span>(exists)&#123;</div><div class="line">            fs.createReadStream(path.join(p,req.path)).pipe(res);</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            next();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="5-重定向"><a href="#5-重定向" class="headerlink" title="5.重定向"></a>5.重定向</h2><ul>
<li>redirect方法允许网址的重定向，跳转到指定的url并且可以指定status，默认为302方式。</li>
<li>参数1 状态码(可选)</li>
<li>参数2 跳转的路径<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">res.redirect([status], url);</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="5-1-redirect使用"><a href="#5-1-redirect使用" class="headerlink" title="5.1 redirect使用"></a>5.1 redirect使用</h3><ul>
<li>使用重定向<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</div><div class="line">    res.redirect(<span class="string">'http://www.baidu.com'</span>)</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="5-2-redirect的实现"><a href="#5-2-redirect的实现" class="headerlink" title="5.2 redirect的实现"></a>5.2 redirect的实现</h3><ul>
<li>302重定向<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">app.use(<span class="function"><span class="keyword">function</span> (<span class="params">req,res,next</span>) </span>&#123;</div><div class="line">    res.redirect = <span class="function"><span class="keyword">function</span> (<span class="params">url</span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(url);</div><div class="line">        res.statusCode = <span class="number">302</span>;</div><div class="line">        res.setHeader(<span class="string">'Location'</span>,<span class="string">'http://www.baidu.com'</span>);</div><div class="line">        res.end(<span class="string">''</span>);</div><div class="line">    &#125;;</div><div class="line">    next();</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="6-接收post响应体"><a href="#6-接收post响应体" class="headerlink" title="6. 接收post响应体"></a>6. 接收post响应体</h2><ul>
<li>安装body-parser<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install body-parser</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="6-1-使用body-parser"><a href="#6-1-使用body-parser" class="headerlink" title="6.1 使用body-parser"></a>6.1 使用body-parser</h3><ul>
<li>接收请求体中的数据<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">app.get(<span class="string">'/login'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</div><div class="line">    res.sendFile(<span class="string">'./login.html'</span>,&#123;root:__dirname&#125;)</div><div class="line">&#125;);</div><div class="line">app.post(<span class="string">'/user'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(req.body);</div><div class="line">    res.send(req.body);</div><div class="line">&#125;);</div><div class="line">app.listen(<span class="number">3000</span>);</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="6-2-req-body的实现"><a href="#6-2-req-body的实现" class="headerlink" title="6.2 req.body的实现"></a>6.2 req.body的实现</h3><ul>
<li>实现bodyParser<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">bodyParser</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">req,res,next</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> result = <span class="string">''</span>;</div><div class="line">        req.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">            result+=data;</div><div class="line">        &#125;);</div><div class="line">        req.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">if</span>(result&amp;&amp;<span class="regexp">/^&#123;.*&#125;$/</span>.test(result))&#123;</div><div class="line">                req.body = <span class="built_in">JSON</span>.parse(result);</div><div class="line">            &#125;<span class="keyword">else</span>&#123;</div><div class="line">                req.body = <span class="built_in">require</span>(<span class="string">'querystring'</span>).parse(result);</div><div class="line">            &#125;</div><div class="line">            next();</div><div class="line">        &#125;)</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://zhufengzhufeng.github.io/2014/08/22/node/express/" data-id="cis5ip4zm0000pwfyxojat87m" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Express/">Express</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2014/08/20/node/hexo搭建博客/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">Hexo搭建静态博客</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/AngularJS/">AngularJS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/GIT的使用/">GIT的使用</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/NODE/">NODE</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2014/08/22/node/express/">Express</a>
          </li>
        
          <li>
            <a href="/2014/08/20/node/hexo搭建博客/">Hexo搭建静态博客</a>
          </li>
        
          <li>
            <a href="/2014/08/20/node/buffer/">Buffer</a>
          </li>
        
          <li>
            <a href="/2014/08/20/node/模块/">node中的模块</a>
          </li>
        
          <li>
            <a href="/2014/08/19/angular/详解angular指令/">Angular指令</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 JW<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">文章收藏</a>
  
</nav>
    

<script src="//cdn.bootcss.com/jquery/2.0.3/jquery.js"></script>




  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/js/search.js"></script>

  </div>
</body>
</html>